<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_191) on Thu Dec 20 19:50:54 CST 2018 -->
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>MDCInterceptor (ratpack-core 1.6.0 API)</title>
<meta name="date" content="2018-12-20">
<link rel="stylesheet" type="text/css" href="../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="MDCInterceptor (ratpack-core 1.6.0 API)";
        }
    }
    catch(err) {
    }
//-->
var methods = {"i0":9,"i1":10,"i2":9};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../../index.html?ratpack/logging/MDCInterceptor.html" target="_top">Frames</a></li>
<li><a href="MDCInterceptor.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">ratpack.logging</div>
<h2 title="Class MDCInterceptor" class="title">Class MDCInterceptor</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>ratpack.logging.MDCInterceptor</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd>ratpack.exec.ExecInterceptor</dd>
</dl>
<hr>
<br>
<pre>public final class <span class="typeNameLabel">MDCInterceptor</span>
extends java.lang.Object
implements ratpack.exec.ExecInterceptor</pre>
<div class="block">An execution interceptor that adds support for SLF4J's <a href="http://www.slf4j.org/manual.html#mdc">Mapped Diagnostic Context (MDC) feature</a>.
 <p>
 The MDC is a set of key-value pairs (i.e. map) that can be implicitly added to all logging statements within the <em>context</em>.
 The term “context” here comes from SLF4J's lexicon and does not refer to Ratpack's <a href="../../ratpack/handling/Context.html" title="interface in ratpack.handling"><code>Context</code></a>.
 It refers to a logical sequence of execution (e.g. handling of a request).
 SLF4J's default strategy for MDC is based on a thread-per-request model, which doesn't work for Ratpack applications.
 This interceptor maps SLF4J's notion of a “context” to Ratpack's notion of an <code>“execution”</code>.
 This means that after installing this interceptor, the <code>MDC API</code> can be used naturally.
 <p>
 Please be sure to read the <a href="http://www.slf4j.org/manual.html#mdc">SLF4J manual section on MDC</a>, particularly about how the actual logging implementation being used must support MDC.
 If your logging implementation doesn't support MDC (e.g. <code>slf4j-simple</code>) then all of the methods on the <code>MDC</code> API become no-ops.
 <p>
 The interceptor should be added to the server registry, so that it automatically is applied to all executions.
 The following example shows the registration of the interceptor and MDC API usage.
 <pre class="java"><code>import java.util.List;
 import java.util.ArrayList;
 import ratpack.test.embed.EmbeddedApp;
 import ratpack.exec.Blocking;
 import org.slf4j.MDC;
 import org.slf4j.Logger;
 import org.slf4j.LoggerFactory;

 import static org.junit.Assert.assertEquals;

 import ratpack.logging.MDCInterceptor;

 public class Example {

   private static final Logger LOGGER = LoggerFactory.getLogger(Example.class);

   public static void main(String... args) throws Exception {
     EmbeddedApp.of(s -&gt; s
       .registryOf(r -&gt; r.add(MDCInterceptor.instance()))
       .handler(r -&gt;
         ctx -&gt; {
           // Put a value into the MDC
           MDC.put("clientIp", ctx.getRequest().getRemoteAddress().getHost());
           // The logging implementation/configuration may inject values from the MDC into log statements
           LOGGER.info("about to block");
           Blocking.get(() -&gt; {
             // The MDC is carried across asynchronous boundaries by the interceptor
             LOGGER.info("blocking");
             return "something";
           }).then(str -&gt; {
             // And back again
             LOGGER.info("back from blocking");
             ctx.render("ok");
           });
         }
       )
     ).test(httpClient -&gt;
       assertEquals("ok", httpClient.getText())
     );
   }
 }
 </code></pre>
 <p>
 Given the code above, using the Log4j bindings with configuration such as:
 <pre><code> &lt;Console name="Console" target="SYSTEM_OUT"&gt;
   &lt;PatternLayout pattern="%d{HH:mm:ss.SSS} [%t] %-5level %logger{36} - %msg - [%X{clientIp}] %n"/&gt;
 &lt;/Console&gt;</code></pre>
 <p>
 The client IP address will be appended to all log messages made while processing requests.
 <h3>Inheritance</h3>
 <p>
 The MDC is not inherited by forked executions (e.g. <code>Execution.fork()</code>).
 If you wish context to be inherited, you must do so explicitly by capturing the variables you wish to be inherited
 (i.e. via <code>MDC.get(String)</code>) as local variables and then add them to the MDC (i.e. via <code>MDC.put(String, String)</code>) in the forked execution.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>ExecInterceptor</code></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<ul class="blockList">
<li class="blockList"><a name="nested.classes.inherited.from.class.ratpack.exec.ExecInterceptor">
<!--   -->
</a>
<h3>Nested classes/interfaces inherited from interface&nbsp;ratpack.exec.ExecInterceptor</h3>
<code>ratpack.exec.ExecInterceptor.ExecType</code></li>
</ul>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>static <a href="../../ratpack/logging/MDCInterceptor.html" title="class in ratpack.logging">MDCInterceptor</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../ratpack/logging/MDCInterceptor.html#instance--">instance</a></span>()</code>
<div class="block">Creates an interceptor with no initialisation action.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../ratpack/logging/MDCInterceptor.html#intercept-ratpack.exec.Execution-ratpack.exec.ExecInterceptor.ExecType-ratpack.func.Block-">intercept</a></span>(ratpack.exec.Execution&nbsp;execution,
         ratpack.exec.ExecInterceptor.ExecType&nbsp;execType,
         ratpack.func.Block&nbsp;executionSegment)</code>&nbsp;</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>static <a href="../../ratpack/logging/MDCInterceptor.html" title="class in ratpack.logging">MDCInterceptor</a></code></td>
<td class="colLast"><code><span class="memberNameLink"><a href="../../ratpack/logging/MDCInterceptor.html#withInit-ratpack.func.Action-">withInit</a></span>(ratpack.func.Action&lt;? super ratpack.exec.Execution&gt;&nbsp;init)</code>
<div class="block">Creates an interceptor with the given initialisation action.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="instance--">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>instance</h4>
<pre>public static&nbsp;<a href="../../ratpack/logging/MDCInterceptor.html" title="class in ratpack.logging">MDCInterceptor</a>&nbsp;instance()</pre>
<div class="block">Creates an interceptor with no initialisation action.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an interceptor with no initialisation action.</dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="../../ratpack/logging/MDCInterceptor.html#withInit-ratpack.func.Action-"><code>withInit(Action)</code></a></dd>
</dl>
</li>
</ul>
<a name="withInit-ratpack.func.Action-">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>withInit</h4>
<pre>public static&nbsp;<a href="../../ratpack/logging/MDCInterceptor.html" title="class in ratpack.logging">MDCInterceptor</a>&nbsp;withInit(ratpack.func.Action&lt;? super ratpack.exec.Execution&gt;&nbsp;init)</pre>
<div class="block">Creates an interceptor with the given initialisation action.
 <p>
 The given action will be executed before the first segment of each execution,
 allowing the MDC to be primed with initial values.
 <p>
 The following demonstrates priming the MDC with the <a href="../../ratpack/handling/RequestId.html" title="interface in ratpack.handling"><code>RequestId</code></a>.

 <pre class="java"><code>import org.slf4j.MDC;
 import ratpack.handling.RequestId;
 import ratpack.logging.MDCInterceptor;
 import ratpack.test.embed.EmbeddedApp;

 import static org.junit.Assert.assertEquals;

 public class Example {
   public static void main(String... args) throws Exception {
     EmbeddedApp.of(s -&gt; s
         .registryOf(r -&gt; r
             .add(MDCInterceptor.withInit(e -&gt;
                 e.maybeGet(RequestId.class).ifPresent(requestId -&gt;
                     MDC.put("requestId", requestId.toString())
                 )
             ))
         )
         .handlers(c -&gt; c
             .get(ctx -&gt; ctx.render(MDC.get("requestId")))
         )
     ).test(http -&gt;
         // The default request ID generator generates UUIDs (i.e. 36 chars long)
         assertEquals(http.getText().length(), 36)
     );
   }
 }
 </code></pre>
 <p>
 If no initialisation is required, use <a href="../../ratpack/logging/MDCInterceptor.html#instance--"><code>instance()</code></a>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>init</code> - the initialisation action</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>an <a href="../../ratpack/logging/MDCInterceptor.html" title="class in ratpack.logging"><code>MDCInterceptor</code></a></dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>1.1</dd>
</dl>
</li>
</ul>
<a name="intercept-ratpack.exec.Execution-ratpack.exec.ExecInterceptor.ExecType-ratpack.func.Block-">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>intercept</h4>
<pre>public&nbsp;void&nbsp;intercept(ratpack.exec.Execution&nbsp;execution,
                      ratpack.exec.ExecInterceptor.ExecType&nbsp;execType,
                      ratpack.func.Block&nbsp;executionSegment)
               throws java.lang.Exception</pre>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>intercept</code>&nbsp;in interface&nbsp;<code>ratpack.exec.ExecInterceptor</code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>execution</code> - the execution that this segment belongs to</dd>
<dd><code>execType</code> - indicates whether this segment is execution on a compute or blocking thread</dd>
<dd><code>executionSegment</code> - the execution segment that is to be executed</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.lang.Exception</code> - any</dd>
</dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../index-all.html">Index</a></li>
<li><a href="../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Class</li>
<li>Next&nbsp;Class</li>
</ul>
<ul class="navList">
<li><a href="../../index.html?ratpack/logging/MDCInterceptor.html" target="_top">Frames</a></li>
<li><a href="MDCInterceptor.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
